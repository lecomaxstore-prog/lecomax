<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Product Details - Lecomax</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>

  <!-- Announcement Bar -->
  <div class="announcement">
    <div class="container announcement__inner">
      <span style="display:flex; align-items:center; gap:8px">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="opacity:0.8"><rect x="1" y="3" width="15" height="13"></rect><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon><circle cx="5.5" cy="18.5" r="2.5"></circle><circle cx="18.5" cy="18.5" r="2.5"></circle></svg>
        Free shipping on all orders over 300 DH
      </span>
      <div class="toplinks">
        <a class="toplink" href="help-center.html">
           <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg> 
           Support
        </a>
        <a class="toplink" href="warranty.html">
           <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
           Warranty
        </a>
      </div>
    </div>
  </div>

  <header class="header" id="header">
    <div class="container header__inner">
      <a class="brand" href="index.html">
        <span class="brand__name"><span style="color:var(--accent)">L'</span>ECOMAX</span>
      </a>

      <div class="search-container">
        <div class="searchbox">
          <input type="search" placeholder="Search..." disabled style="opacity:0.7">
          <button class="searchbox__submit" type="button"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg></button>
        </div>
      </div>

      <div class="actions">
        <a href="index.html" class="iconbtn" aria-label="Home">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
        </a>
        <button class="iconbtn" id="openCart" type="button" aria-label="Cart">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
          <span class="badge" id="cartCount">0</span>
        </button>
      </div>
    </div>
  </header>

  <main class="section">
    <div class="container" id="product-content">
      <!-- Content injected by JS -->
      <div style="padding:100px; text-align:center; color:var(--muted)">Loading product...</div>
    </div>
  </main>

  <footer class="footer">
    <div class="container footer__inner">
      <p class="muted">© <span id="year"></span> Lecomax. All rights reserved.</p>
    </div>
  </footer>

  <!-- Cart Drawer -->
  <aside class="drawer" id="drawer" aria-hidden="true">
    <div class="drawer__bg" data-close="1"></div>
    <div class="drawer__panel">
      <div class="drawer__head">
         <div class="drawer__title">Cart</div>
         <button class="iconbtn" data-close="1" onclick="closeAll()">✕</button>
      </div>
      <div class="drawer__body" id="cartItems"></div>
      <div class="drawer__foot">
         <div class="totals"><span class="muted">Total</span><strong id="total">0 DH</strong></div>
         <button class="btn btn--primary w100" id="checkout">Checkout</button>
      </div>
    </div>
  </aside>

<script src="app.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");
    if(id) renderProductDetail(id);
    else showNotFound();
    
    // Wire up year
    const yearEl = document.getElementById("year");
    if(yearEl) yearEl.textContent = new Date().getFullYear();
  });

  function showNotFound() {
      document.getElementById("product-content").innerHTML = "<div style='text-align:center; padding: 60px;'><h2>Product Not Found</h2><br><a href='index.html' class='btn btn--primary'>Continue Shopping</a></div>";
  }

  function renderProductDetail(id) {
     const p = PRODUCTS.find(x => x.id === id);
     if(!p) { showNotFound(); return; }

     // Determine colors
     let colorHtml = "";
     if(p.colors && p.colors.length > 0) {
         colorHtml = `<div class="options-wrap">
             <div class="option-label">Color: <span id="colorName">${p.colors[0].name}</span></div>
             <div class="colors-list">
                ${p.colors.map((c, i) => `
                   <button class="color-swatch ${i===0?'selected':''}" onclick="selectColor(this, '${c.img}', '${c.name.replace(/'/g, "\\'")}')" style="background:${c.hex};" title="${c.name}"></button>
                `).join("")}
             </div>
         </div>`;
     }
     
     // Determine thumbs
     let thumbHtml = "";
     if(p.images && p.images.length > 0) {
         thumbHtml = p.images.map((src, i) => `
            <div class="thumb-btn ${i===0?'active':''}" onclick="setMainImage(this, '${src}')">
              <img src="${src}" alt="">
            </div>
         `).join("");
     }

     // Generate specs block
     let specsHtml = "";
     if (p.specs) {
        specsHtml = `<div class="specs-block" id="specs">
            <h3 style="font-size: 1.6rem; font-weight: 800; margin-bottom: 30px;">Product Specifications</h3>
            <div class="specs-grid-layout">
                ${Object.entries(p.specs).map(([category, items]) => `
                    <div class="spec-group">
                        <h4>${category}</h4>
                        <div class="spec-list">
                            ${Object.entries(items).map(([key, value]) => `
                                <div class="spec-row">
                                    <span class="spec-key">${key}</span>
                                    <span class="spec-val">${value}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>`;
     }

     // Generate fake reviews
     let reviews = getFakeReviews(p.id, p.cat);
     
     // Hack to ensure 4.8 average visually as requested
     if(reviews.length > 0) {
        // Force 9 out of 11 to be 5 stars, 2 to be 4 stars => 4.81 avg
        reviews = reviews.map((r, i) => {
            r.rating = (i < 9) ? 5.0 : 4.0;
            return r;
        });
     }

     // Calculate review stats
     const totalReviews = reviews.length;
     const avgRating = (reviews.reduce((acc, r) => acc + r.rating, 0) / (totalReviews || 1)).toFixed(1);
     const counts = {5:0, 4:0, 3:0, 2:0, 1:0};
     reviews.forEach(r => {
        const rounded = Math.round(r.rating);
        if(counts[rounded] !== undefined) counts[rounded]++;
     });

     const summaryHtml = `
        <div class="review-summary" style="display:flex; align-items:flex-start; gap:40px; margin-bottom:40px; padding:30px; background:#f8fafc; border-radius:16px;">
            <div style="text-align:center; min-width:120px;">
                <div style="font-size:3rem; font-weight:800; line-height:1; color:#0f172a;">${avgRating}</div>
                <div class="stars" style="color:#f59e0b; margin:8px 0;">★★★★★</div>
                <div class="muted" style="font-size:0.9rem;">${totalReviews} Reviews</div>
            </div>
            <div style="flex:1; display:flex; flex-direction:column; gap:8px;">
                ${Object.keys(counts).sort((a,b)=>b-a).map(star => {
                    const count = counts[star];
                    const pct = totalReviews ? (count / totalReviews) * 100 : 0;
                    return `
                    <div style="display:flex; align-items:center; gap:12px; font-size:0.9rem;">
                        <span style="width:12px; font-weight:600;">${star}</span>
                        <svg width="14" height="14" fill="#f59e0b" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.77 5.82 22 7 14.14l-5-4.87 6.91-1.01z"/></svg>
                        <div style="flex:1; height:8px; background:#e2e8f0; border-radius:4px; overflow:hidden;">
                            <div style="width:${pct}%; height:100%; background:#f59e0b; border-radius:4px;"></div>
                        </div>
                        <span style="width:30px; text-align:right; color:var(--muted);">${count}</span>
                    </div>`;
                }).join('')}
            </div>
        </div>
     `;

     let reviewsHtml = reviews.map(r => `
         <div class="review-item" style="border-bottom:1px solid #f1f5f9; padding-bottom:20px; margin-bottom:20px;">
            <div class="review-header" style="display:flex; align-items:center; gap:12px; margin-bottom:8px;">
                <div class="review-avatar" style="width:40px; height:40px; background:#f1f5f9; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:700; color:var(--muted);">${r.name.charAt(0)}</div>
                <div>
                    <div style="font-weight:700; font-size:0.95rem">${r.name}</div>
                    <div class="stars" style="font-size:0.8rem; color:#f59e0b">${"★".repeat(Math.round(r.rating))}${"☆".repeat(5-Math.round(r.rating))}</div>
                </div>
                <div class="muted tiny" style="margin-left:auto">${r.date}</div>
            </div>
            <p style="color:var(--text); line-height:1.6; font-size:0.95rem;">${r.text}</p>
         </div>
     `).join("");

      const html = `
        <div class="product-page">
           <!-- Improved Breadcrumb -->
           <nav class="breadcrumb" style="margin: 20px 0 32px 0; font-size: 0.85rem; color: var(--muted); display:flex; align-items:center; gap:8px;">
              <a href="index.html" style="color:var(--muted); text-decoration:none; transition:color 0.2s; display:flex; align-items:center; gap:4px">
                 <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                 Home
              </a>
              <span style="opacity:0.3">/</span>
              <a href="index.html?cat=${p.cat}" style="color:var(--muted); text-decoration:none; transition:color 0.2s">${label(p.cat)}</a>
              <span style="opacity:0.3">/</span>
              <span style="color:var(--text); font-weight:500">${p.name}</span>
           </nav>
        
        <div class="product-layout">
            <!-- Gallery Column -->
            <div class="product-gallery">
                <div class="main-image-wrapper">
                    <img id="ppMainImg" src="${p.images && p.images[0] ? p.images[0] : ''}" alt="${p.name}">
                    ${!(p.images && p.images.length) ? `<div style="font-size:8rem">${p.emoji}</div>` : ''}
                </div>
                <div class="thumbnails">
                    ${thumbHtml}
                </div>
            </div>
            
            <!-- Info Column -->
            <div class="product-info-col">
                <div class="product-cat">${label(p.cat)}</div>
                <h1 class="product-title">${p.name}</h1>
                
                <div class="price-block">
                    <div class="current-price">${p.price} DH</div>
                    ${p.old ? `<div class="old-price">${p.old} DH</div>` : ''}
                    ${p.old ? `<div class="save-badge">Save ${Math.round(((p.old - p.price)/p.old)*100)}%</div>` : ''}
                </div>

                <div class="rating-block">
                    <span class="stars" style="color:#f59e0b; letter-spacing:1px;">★★★★★</span> 
                    <span>${p.rating.toFixed(1)}</span>
                    <a href="#reviews" class="muted" style="text-decoration:underline; font-weight:400; margin-left:6px;">(11 reviews)</a>
                </div>
                
                <p class="description">
                    ${p.desc || "Experience premium quality with our latest collection."}
                </p>

                <hr class="divider">

                ${colorHtml}

                <div class="cart-actions">
                     <div class="qty-box">
                        <button class="qty-btn" onclick="updateQty(-1)">−</button>
                        <input id="qtyInput" class="qty-val" value="1" readonly>
                        <button class="qty-btn" onclick="updateQty(1)">+</button>
                     </div>
                     <button class="btn btn--primary add-btn" onclick="addToCart('${p.id}', getQty()); setTimeout(()=> window.location.href='index.html?cart=open', 100)">
                        Add to Cart
                     </button>
                      <button class="fav-action-btn" onclick="addToCart('${p.id}', getQty()); showToast('Added to Cart')" title="Add to Wishlist">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                     </button>
                </div>
                
                <div class="trust-bar" style="margin-top:20px; border-top:1px solid var(--line); padding-top:30px; display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                    <div style="display:flex; align-items:center; gap:12px">
                        <div style="width:40px; height:40px; background:#f0f9ff; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#0284c7">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="3" width="15" height="13"></rect><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon><circle cx="5.5" cy="18.5" r="2.5"></circle><circle cx="18.5" cy="18.5" r="2.5"></circle></svg>
                        </div>
                        <div style="font-size:0.9rem; font-weight:600">Free Express Delivery</div>
                    </div>
                    <div style="display:flex; align-items:center; gap:12px">
                        <div style="width:40px; height:40px; background:#f0fdf4; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#16a34a">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                        </div>
                        <div style="font-size:0.9rem; font-weight:600">2 Year Warranty</div>
                    </div>
                    <div style="display:flex; align-items:center; gap:12px">
                        <div style="width:40px; height:40px; background:#fefce8; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#ca8a04">
                             <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>
                        </div>
                        <div style="font-size:0.9rem; font-weight:600">30-Day Returns</div>
                    </div>
                     <div style="display:flex; align-items:center; gap:12px">
                        <div style="width:40px; height:40px; background:#f5f3ff; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#7c3aed">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>
                        </div>
                        <div style="font-size:0.9rem; font-weight:600">Secure Payment</div>
                    </div>
                </div>
            </div>
        </div>

        ${specsHtml}

        <!-- REVIEWS SECTION -->
        <div class="reviews-section" id="reviews" style="margin-top: 80px;">
            <h3 style="font-size:1.6rem; margin-bottom:30px; font-weight:800;">Customer Reviews</h3>
            ${summaryHtml}
            ${reviewsHtml}
        </div>
        
        <!-- RELATED PRODUCTS -->
        <div class="related-section" style="margin-top:80px; padding-top:40px; border-top:1px solid var(--line)">
             <h3 style="font-size:1.6rem; margin-bottom:24px; font-weight:800;">You might also like</h3>
             <div class="horizontal-scroll" id="relatedList" style="display:flex; gap:16px; overflow-x:auto; padding-bottom:20px;"></div>
        </div>
      </div>
     `;
     
     document.getElementById("product-content").innerHTML = html;
     
     if (typeof getCardHTML === "function") {
         const related = PRODUCTS.filter(x => x.cat === p.cat && x.id !== p.id).slice(0, 4);
         const listEl = document.getElementById("relatedList");
         if(related.length && listEl) {
             listEl.innerHTML = related.map(getCardHTML).join("");
         } else if(listEl) {
            document.querySelector(".related-section").style.display = 'none';
         }
     }
  }

  window.updateQty = function(d) {
      const inp = document.getElementById("qtyInput");
      let v = parseInt(inp.value) + d;
      if(v < 1) v = 1;
      inp.value = v;
  };
  window.getQty = function() {
      return parseInt(document.getElementById("qtyInput").value) || 1;
  };

  // Gallery Logic
  window.setMainImage = function(btn, src) {
      const img = document.getElementById("ppMainImg");
      if(img) {
          img.style.opacity = "0.5";
          setTimeout(() => {
              img.src = src;
              img.style.opacity = "1";
          }, 150);
      }
      
      document.querySelectorAll(".thumb-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
  };

  // Color Logic
  window.selectColor = function(btn, imgUrl, colorName) {
      if(colorName) {
        const cn = document.getElementById("colorName");
        if(cn) cn.textContent = colorName;
      }
      
      document.querySelectorAll(".color-swatch").forEach(b => b.classList.remove("selected"));
      btn.classList.add("selected");
      
      if(imgUrl && imgUrl !== 'undefined') {
          const thumbs = document.querySelectorAll(".thumb-btn img");
          let foundThumb = null;
          thumbs.forEach(t => {
              if(t.src === imgUrl) foundThumb = t.parentElement;
          });
          
          if(foundThumb) {
              setMainImage(foundThumb, imgUrl);
          } else {
               const img = document.getElementById("ppMainImg");
               if(img) img.src = imgUrl;
          }
      }
  };
  
  function label(cat){
      return cat.charAt(0).toUpperCase() + cat.slice(1);
  }
</script>
<button id="backToTop" aria-label="Back to top">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19V5"></path><path d="M5 12l7-7 7 7"></path></svg>
</button>
</body>
</html>
