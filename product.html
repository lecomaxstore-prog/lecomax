<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9N1CPZQ1HG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('consent', 'default', {
    ad_storage: 'denied',
    analytics_storage: 'denied',
    ad_user_data: 'denied',
    ad_personalization: 'denied',
    wait_for_update: 500
  });
  gtag('js', new Date());

  gtag('config', 'G-9N1CPZQ1HG', { anonymize_ip: true });
</script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Product Details - Lecomax</title>
  <meta name="description" content="Explore detailed Lecomax product pages with pricing, reviews, options, and secure checkout flow." />
  <meta name="robots" content="index,follow,max-image-preview:large" />
  <link rel="canonical" href="https://lecomax.com/product.html" />

  <!-- Open Graph / Link Preview Tags -->
  <meta property="og:title" content="Premium Product - Lecomax" />
  <meta property="og:description" content="Check out our latest premium electronics, fashion, and accessories. Fast delivery and quality guaranteed." />
  <meta property="og:type" content="product" />
  <meta property="og:image" content="https://raw.githubusercontent.com/lecomaxstore-prog/lecomax/refs/heads/main/images/WirelessGamingController/1.avif" />
  
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Premium Product - Lecomax" />
  <meta name="twitter:description" content="Check out our latest premium electronics, fashion, and accessories." />
  <meta name="twitter:image" content="https://raw.githubusercontent.com/lecomaxstore-prog/lecomax/refs/heads/main/images/WirelessGamingController/1.avif" />

  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>

  <!-- Announcement Bar -->
  <div class="announcement">
    <div class="container announcement__inner">
      <span class="announcement-note">
        <svg class="announcement-note__icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="3" width="15" height="13"></rect><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon><circle cx="5.5" cy="18.5" r="2.5"></circle><circle cx="18.5" cy="18.5" r="2.5"></circle></svg>
        Free shipping on all products
      </span>
      <div class="toplinks">
        <a class="toplink" href="help-center.html">
           <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg> 
           Support
        </a>
        <a class="toplink" href="warranty.html">
           <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
           Warranty
        </a>
      </div>
    </div>
  </div>

  <header class="header" id="header">
    <div class="container header__inner">
      <a class="brand" href="index.html" aria-label="Lecomax Home">
        <!-- New Logo Icon -->
        <svg class="brand__logo" width="34" height="34" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M8 8C8 5.79086 9.79086 4 12 4H16C18.2091 4 20 5.79086 20 8V32C20 34.2091 18.2091 36 16 36H12C9.79086 36 8 34.2091 8 32V8Z" fill="#3b82f6"/>
          <path d="M22 24C22 21.7909 23.7909 20 26 20H32C34.2091 20 36 21.7909 36 24V32C36 34.2091 34.2091 36 32 36H26C23.7909 36 22 34.2091 22 32V24Z" fill="#0f172a"/>
        </svg>
        <span class="brand__name"><span class="brand__accent">L'</span>ECOMAX</span>
      </a>

      <div class="search-container">
        <div class="searchbox">
          <input type="search" placeholder="Search..." disabled class="search-input-disabled">
          <button class="searchbox__submit" type="button"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg></button>
        </div>
      </div>

      <div class="actions">
        <a href="index.html" class="iconbtn" aria-label="Home">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
        </a>
        <button class="iconbtn" id="openCart" type="button" aria-label="Cart">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
          <span class="badge" id="cartCount">0</span>
        </button>
      </div>
    </div>
  </header>

  <main class="section">
    <div class="container" id="product-content">
      <!-- Content injected by JS -->
      <div class="product-loading">Loading product...</div>
    </div>
  </main>

  <footer class="footer">
    <div class="container footer__inner">
      <p class="muted">© <span id="year"></span> Lecomax. All rights reserved.</p>
    </div>
  </footer>

  <!-- Cart Drawer -->
  <aside class="drawer" id="drawer" aria-hidden="true">
    <div class="drawer__bg" data-close="1"></div>
    <div class="drawer__panel">
      <div class="drawer__head">
         <div class="drawer__title">Cart</div>
         <button class="iconbtn" data-close="1" onclick="closeAll()">✕</button>
      </div>
      <div class="drawer__body" id="cartItems"></div>
      <div class="drawer__foot">
         <div class="totals"><span class="muted">Total</span><strong id="total">0 MAD</strong></div>
         <button class="btn btn--primary w100" id="checkout">Checkout</button>
      </div>
    </div>
  </aside>

<script src="app.js"></script>
<script src="cookie-consent.js"></script>
<script>
  // Current product global
  let currentProduct = null;
  let currentUIText = null;
  let productGalleryItems = [];
  let activeGalleryIndex = 0;

  document.addEventListener('keydown', (e) => {
    const viewer = document.getElementById('imageViewer');
    if(!viewer || !viewer.classList.contains('is-open')) return;
    if(e.key === 'Escape') {
      e.preventDefault();
      closeImageViewer();
      return;
    }
    if(e.key === 'ArrowRight') {
      e.preventDefault();
      scrollImageViewer(1);
      return;
    }
    if(e.key === 'ArrowLeft') {
      e.preventDefault();
      scrollImageViewer(-1);
    }
  });

  // Listen for language changes to re-render product details
  window.addEventListener('languageChanged', (e) => {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");
      if(id && typeof renderProductDetail === 'function') {
          renderProductDetail(id);
      }
  });

  document.addEventListener("DOMContentLoaded", () => {
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");
    if(id) renderProductDetail(id);
    else showNotFound();
    
    // Wire up year
    const yearEl = document.getElementById("year");
    if(yearEl) yearEl.textContent = new Date().getFullYear();
  });

  function showNotFound() {
      document.getElementById("product-content").innerHTML = "<div class='product-not-found'><h2>Product Not Found</h2><br><a href='index.html' class='btn btn--primary'>Continue Shopping</a></div>";
  }

  function renderProductDetail(id) {
     const rawP = PRODUCTS.find(x => x.id === id);
     if(!rawP) { showNotFound(); return; }
     
     // Localize based on current settings
     const lang = localStorage.getItem('lecomax_lang') || 'en';
     const p = { ...rawP }; // clone to avoid mutating original shared object permanently if we switched back and forth
     
     if(lang === 'fr') {
         if(p.name_fr) p.name = p.name_fr;
         if(p.desc_fr) p.desc = p.desc_fr;
     } else if (lang === 'ar') {
         if(p.name_ar) p.name = p.name_ar;
         if(p.desc_ar) p.desc = p.desc_ar;
     }
     
     // Translation Dictionary for UI Elements
     const UI_TEXT = {
         en: {
             specs_title: "Product Specifications",
             reviews_title: "Customer Reviews",
             based_on: "Based on",
             reviews: "reviews",
           home: "Home",
           back: "Go Back",
             you_might_like: "You might also like",
             verified_buyer: "Verified Buyer",
             add_to_cart: "Add to Cart",
             sold_out: "Sold Out",
           size: "Size",
           select: "Select",
           please_select_size: "Please select a size",
           added_to_cart: "Added to Cart",
           added_to_favorites: "Added to Favorites",
           removed_from_favorites: "Removed from Favorites",
             save: "Save",
             free_shipping_title: "Free Express",
             free_shipping_desc: "Delivery in 3 days",
             warranty_title: "12 Months",
             warranty_desc: "Official warranty",
             returns_title: "30-Day",
             returns_desc: "Easy returns",
             payment_title: "Secure",
             payment_desc: "Payment",
             color: "Color"
         },
         fr: {
             specs_title: "Spécifications du Produit",
             reviews_title: "Avis Clients",
             based_on: "Basé sur",
             reviews: "avis",
           home: "Accueil",
           back: "Retour",
             you_might_like: "Vous aimerez peut-être aussi",
             verified_buyer: "Acheteur Vérifié",
             add_to_cart: "Ajouter au Panier",
             sold_out: "Épuisé",
           size: "Taille",
           select: "Choisir",
           please_select_size: "Veuillez choisir une taille",
           added_to_cart: "Ajouté au panier",
           added_to_favorites: "Ajouté aux favoris",
           removed_from_favorites: "Retiré des favoris",
             save: "Économisez",
             free_shipping_title: "Livraison Express",
             free_shipping_desc: "Gratuite en 3 jours",
             warranty_title: "12 Mois",
             warranty_desc: "Garantie officielle",
             returns_title: "30 Jours",
             returns_desc: "Retours faciles",
             payment_title: "Paiement",
             payment_desc: "Sécurisé",
             color: "Couleur"
         },
         ar: {
             specs_title: "مواصفات المنتج",
             reviews_title: "آراء العملاء",
             based_on: "بناءً على",
             reviews: "مراجعة",
           home: "الرئيسية",
           back: "رجوع",
             you_might_like: "قد يعجبك أيضاً",
             verified_buyer: "مشتري موثق",
             add_to_cart: "أضف إلى السلة",
             sold_out: "نفذت الكمية",
           size: "المقاس",
           select: "اختر",
           please_select_size: "يرجى اختيار المقاس",
           added_to_cart: "تمت الإضافة إلى السلة",
           added_to_favorites: "تمت الإضافة إلى المفضلة",
           removed_from_favorites: "تمت الإزالة من المفضلة",
             save: "وفر",
             free_shipping_title: "شحن سريع",
             free_shipping_desc: "توصيل خلال 3 أيام",
             warranty_title: "12 شهراً",
             warranty_desc: "ضمان معتمد",
             returns_title: "30 يوماً",
             returns_desc: "استرجاع سهل",
             payment_title: "دفع",
             payment_desc: "آمن",
             color: "اللون"
         }
     };
     
     const txt = UI_TEXT[lang] || UI_TEXT.en;
    currentUIText = txt;
     
     // Spec Key/Value Translations (Best Effort)
     const SPEC_TRANS = {
        fr: {
            "Brand": "Marque", "Model": "Modèle", "Material": "Matériau", "Color": "Couleur",
            "Style": "Style", "Gender": "Genre", "Season": "Saison", "Size": "Taille",
            "Weight": "Poids", "Dimensions": "Dimensions", "Features": "Caractéristiques",
            "General": "Général", "Design": "Design", "Black": "Noir", "White": "Blanc",
            "Men": "Hommes", "Women": "Femmes", "Casual": "Décontracté", "Sports": "Sport",
            "Polyester": "Polyester", "Cotton": "Coton", "Origin": "Origine", "China": "Chine",
            "Wireless": "Sans fil", "Battery": "Batterie", "Charging": "Recharge",
            "Product Type": "Type de Produit", "Closure Type": "Fermeture", "Sleeve Length": "Manches",
            "Available Sizes": "Tailles Disponibles", "Usage": "Usage", "Pattern": "Motif",
            "Solid": "Uni", "Hooded": "À capuche", "Pockets": "Poches", "Regular": "Régulier",
            "Loose": "Ample", "Fit Type": "Coupe", "Connectivity": "Connectivité", "None": "Aucun"
        },
        ar: {
            "Brand": "العلامة التجارية", "Model": "الموديل", "Material": "الخامة", "Color": "اللون",
            "Style": "النمط", "Gender": "الجنس", "Season": "الفصل", "Size": "المقاس",
            "Weight": "الوزن", "Dimensions": "الأبعاد", "Features": "الميزات",
            "General": "عام", "Design": "التصميم", "Black": "أسود", "White": "أبيض",
            "Men": "رجال", "Women": "نساء", "Casual": "كاجوال", "Sports": "رياضي",
            "Polyester": "بوليستر", "Cotton": "قطن", "Origin": "المنشأ", "China": "الصين",
            "Wireless": "لاسلكي", "Battery": "البطارية", "Charging": "الشحن",
            "Product Type": "نوع المنتج", "Closure Type": "نوع الإغلاق", "Sleeve Length": "طول الكم",
            "Available Sizes": "المقاسات المتوفرة", "Usage": "الاستخدام", "Pattern": "النقش",
            "Solid": "لون موحد", "Hooded": "بقلنسوة", "Pockets": "جيوب", "Regular": "عادي",
            "Loose": "واسع", "Fit Type": "نوع القصة", "Connectivity": "الاتصال", "None": "لا يوجد"
        }
     };
     
     const trSpec = (str) => {
         if(!str) return str;
         if(typeof str !== 'string') return str;
         const map = SPEC_TRANS[lang];
         if(!map) return str;
         // Try exact match first
         if(map[str]) return map[str];
         // Try replace common words if key is sentence-like? (Risky, skip for now to avoid broken sentences)
         return str;
     }


     currentProduct = p;
  productGalleryItems = Array.isArray(p.images) ? p.images.filter(Boolean) : [];
  activeGalleryIndex = 0;

     // Determine colors
     let colorHtml = "";
     if(p.colors && p.colors.length > 0) {
         // Auto-select first non-soldout color
         const defaultColor = p.colors.find(c => !c.soldOut) || p.colors[0];

         colorHtml = `<div class="options-wrap">
             <div class="option-label">${txt.color}: <span id="colorName">${defaultColor.name}</span></div>
             <div class="colors-list">
                ${p.colors.map((c, i) => `
                   <button class="color-swatch ${c.soldOut ? 'sold-out' : ''} ${c.name === defaultColor.name ? 'selected' : ''}" 
                     onclick="if(!this.classList.contains('sold-out')) selectColor(this, '${c.img}', '${c.name.replace(/'/g, "\\'")}')" 
                     data-swatch-color="${c.hex}"
                     title="${c.name} ${c.soldOut ? '(Sold Out)' : ''}">
                     ${c.soldOut ? '<span class="color-swatch__x">✕</span>' : ''}
                   </button>
                `).join("")}
             </div>
         </div>`;
     }
     
     // Determine sizes (Initial render based on default color)
     let sizeHtml = "";
     // We create a container for sizes that we can update later
     sizeHtml = `<div id="sizesContainer"></div>`;
     
     // ... rest of generation ...

     // Determine thumbs
     let thumbHtml = "";
     
     // Add Video Thumbnail if exists
     if(p.video) {
        thumbHtml += `
            <div class="thumb-btn video-thumb" onclick="setMainVideo(this, '${p.video}')">
              <div class="video-thumb__play">▶</div>
              <video src="${p.video}" muted class="video-thumb__media" preload="metadata"></video>
            </div>
        `;
     }
     
     if(p.images && p.images.length > 0) {
         thumbHtml += p.images.map((src, i) => `
            <div class="thumb-btn ${i===0 && !p.video ?'active':''}" onclick="setMainImage(this, '${src.replace(/'/g, "\\'")}')">
              <img src="${src}" alt="${p.name}" loading="lazy" decoding="async">
            </div>
         `).join("");
     }

     // Generate specs block
     let specsHtml = "";
     if (p.specs) {
        specsHtml = `<div class="specs-block" id="specs">
            <h3 class="section-title">${txt.specs_title}</h3>
            <div class="specs-grid-layout">
                ${Object.entries(p.specs).map(([category, items]) => `
                    <div class="spec-group">
                        <h4>${trSpec(category)}</h4>
                        <div class="spec-list">
                            ${Object.entries(items).map(([key, value]) => `
                                <div class="spec-row">
                                    <span class="spec-key">${trSpec(key)}</span>
                                    <span class="spec-val">${trSpec(value)}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>`;
     }

      // Generate realistic high ratings (mostly 5 and 4 stars)
      let reviewCount = Math.max(12, (hashStr(p.id) % 20) + 12); // 12..32 reviews
      let rTotal = reviewCount;
      
      // Dynamic distribution logic based on rating
      let d5=0, d4=0, d3=0, d2=0, d1=0;
      
      if (p.rating >= 4.7) {
        d5 = Math.ceil(rTotal * 0.85);
        if(d5 > rTotal) d5 = rTotal;
        d4 = rTotal - d5;
      } else if (p.rating >= 4.0) {
        d5 = Math.floor(rTotal * 0.60);
        d4 = Math.floor(rTotal * 0.30);
        d3 = rTotal - d5 - d4;
      } else {
        d5 = Math.floor(rTotal * 0.50);
        d4 = Math.floor(rTotal * 0.30);
        d3 = Math.floor(rTotal * 0.15);
        d2 = rTotal - d5 - d4 - d3;
      }
      
      let rDist = [d5, d4, d3, d2, d1];
     
     const ratingSummaryHtml = `
        <div class="rating-summary">
              <div class="rating-overall">
                 <div class="rating-score">${p.rating.toFixed(1)} <span class="rating-out-of">/ 5</span></div>
                 <div class="rating-stars-lg rating-stars-accent">${typeof starIcons === 'function' ? starIcons(Math.round(p.rating)) : "★★★★★"}</div>
                 <div class="rating-count-lg">${txt.based_on} ${reviewCount} ${txt.reviews}</div>
              </div>
          <div class="rating-bars">
             <div class="rating-bar-row">
                 <span class="r-label">5 ★</span>
                 <div class="r-track"><div class="r-fill" data-width="${(rDist[0]/reviewCount*100).toFixed(0)}"></div></div>
                 <span class="r-count">${rDist[0]}</span>
             </div>
             <div class="rating-bar-row">
                 <span class="r-label">4 ★</span>
                 <div class="r-track"><div class="r-fill" data-width="${(rDist[1]/reviewCount*100).toFixed(0)}"></div></div>
                 <span class="r-count">${rDist[1]}</span>
             </div>
             <div class="rating-bar-row">
                 <span class="r-label">3 ★</span>
                 <div class="r-track"><div class="r-fill" data-width="${(rDist[2]/reviewCount*100).toFixed(0)}"></div></div>
                 <span class="r-count">${rDist[2]}</span>
             </div>
             <div class="rating-bar-row">
                 <span class="r-label">2 ★</span>
                 <div class="r-track"><div class="r-fill" data-width="${(rDist[3]/reviewCount*100).toFixed(0)}"></div></div>
                 <span class="r-count">${rDist[3]}</span>
             </div>
             <div class="rating-bar-row">
                 <span class="r-label">1 ★</span>
                 <div class="r-track"><div class="r-fill" data-width="${(rDist[4]/reviewCount*100).toFixed(0)}"></div></div>
                 <span class="r-count">${rDist[4]}</span>
             </div>
          </div>
        </div>
     `;

    let reviewsHtml = `<div class="reviews-grid">` + getFakeReviews(p.id, p.cat, lang, p.rating).slice(0, 5).map(r => {
         const colors = ['review-bg-blue', 'review-bg-green', 'review-bg-purple', 'review-bg-orange'];
         const colorClass = colors[hashStr(r.name) % colors.length];
         
         return `
         <div class="review-card">
            <div class="review-header">
                <div class="review-avatar ${colorClass}">${r.name.charAt(0)}</div>
                <div class="review-meta">
                    <div class="review-author">
                        ${r.name}
                        <span class="verified-badge">
                           <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                           ${txt.verified_buyer}
                        </span>
                    </div>
                    <div class="review-stars review-stars-accent">${typeof starIcons === 'function' ? starIcons(Math.round(r.rating)) : "★".repeat(Math.round(r.rating))}</div>
                </div>
                <div class="review-date">${r.date}</div>
            </div>
            <div class="review-body">
                “${r.text}”
            </div>
            <div class="review-tags">
                <span class="review-tag">${r.tag}</span>
            </div>
         </div>
     `}).join("") + `</div>`;

      const html = `
        <div class="product-page">
           <!-- Improved Breadcrumb -->
            <nav class="breadcrumb breadcrumb--product">
              <button class="breadcrumb-back" onclick="history.back()" title="${txt.back}">
                 <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
              </button>
              
              <a href="index.html" class="breadcrumb-home">
                 <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                  ${txt.home}
              </a>
              <span class="breadcrumb-sep">/</span>
              <a href="index.html?cat=${p.cat}" class="breadcrumb-link">${label(p.cat)}</a>
              <span class="breadcrumb-sep">/</span>
              <span class="breadcrumb-current">${p.name}</span>
           </nav>
        
        <div class="product-layout">
            <!-- Gallery Column -->
            <div class="product-gallery">
                <div class="main-image-wrapper">
                    <div class="zoom-container">
                      <img id="ppMainImg" class="pp-main-img ${(p.images && p.images.length) ? '' : 'is-hidden'}" src="${p.images && p.images[0] ? p.images[0] : ''}" alt="${p.name}" loading="eager" decoding="async" fetchpriority="high">
                      <div id="zoomLens" class="zoom-lens"></div>
                    </div>
                    <video id="ppMainVideo" class="pp-main-video" controls autoplay loop playsinline muted></video>
                  <div id="ppImageFallback" class="product-image-fallback ${!(p.images && p.images.length) ? 'is-visible' : ''}">${p.emoji}</div>
                </div>
                <div class="thumbnails">
                    ${thumbHtml}
                </div>
            </div>
            
            <!-- Info Column -->
            <div class="product-info-col">
                <div class="product-cat">
                    ${label(p.cat)}
                </div>
                <h1 class="product-title">${p.name}</h1>
                
                <div class="price-block">
                  <div class="current-price">${p.price} MAD</div>
                  ${p.old ? `<div class="old-price">${p.old} MAD</div>` : ''}
                  ${p.old ? `<div class="save-badge">${txt.save} ${Math.round(((p.old - p.price)/p.old)*100)}%</div>` : ''}
                </div>

                <div class="rating-block">
                  ${typeof starIcons === 'function' ? starIcons(Math.round(p.rating)) : '<span class="stars rating-stars-fallback">★★★★★</span>'} 
                  <span class="rating-value">${p.rating.toFixed(1)}</span>
                  <a href="#reviews" class="muted rating-link">(${reviewCount} ${txt.reviews})</a>
                </div>
                
                <p class="description">
                    ${p.desc || "Experience premium quality with our latest collection."}
                </p>

                <hr class="divider">

                ${colorHtml}
                ${sizeHtml}

                <div class="cart-actions">
                   <div class="qty-box">
                    <button class="qty-btn" onclick="updateQty(-1)">−</button>
                    <input id="qtyInput" class="qty-val" value="1" readonly>
                    <button class="qty-btn" onclick="updateQty(1)">+</button>
                     </div>
                     
                    <button id="addToCartBtn" class="btn btn--primary add-btn" onclick="handleAddToCart('${p.id}')" ${!isProductInStock(p) ? 'disabled style="opacity:0.5; cursor:not-allowed;"' : ''}>
                        ${!isProductInStock(p) ? (txt.sold_out || 'Sold Out') : txt.add_to_cart}
                     </button>
                     
                    <button id="favActionBtn" class="fav-action-btn" onclick="handleToggleFavorite('${p.id}')" title="${txt.added_to_favorites}">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                     </button>
                </div>
                
                <div class="trust-bar">
                  <div class="trust-item">
                    <div class="trust-icon trust-icon--shipping">
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="3" width="15" height="13"></rect><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon><circle cx="5.5" cy="18.5" r="2.5"></circle><circle cx="18.5" cy="18.5" r="2.5"></circle></svg>
                        </div>
                    <div class="trust-copy">${txt.free_shipping_title}<br><span>${txt.free_shipping_desc}</span></div>
                    </div>
                    
                  <div class="trust-item">
                    <div class="trust-icon trust-icon--warranty">
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                        </div>
                    <div class="trust-copy">${txt.warranty_title}<br><span>${txt.warranty_desc}</span></div>
                    </div>

                  <div class="trust-item">
                    <div class="trust-icon trust-icon--returns">
                             <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>
                        </div>
                    <div class="trust-copy">${txt.returns_title}<br><span>${txt.returns_desc}</span></div>
                    </div>
                    
                   <div class="trust-item">
                    <div class="trust-icon trust-icon--payment">
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>
                        </div>
                    <div class="trust-copy">${txt.payment_title}<br><span>${txt.payment_desc}</span></div>
                    </div>
                </div>
            </div>
        </div>

        ${specsHtml}

        <!-- REVIEWS SECTION -->
        <div class="reviews-section" id="reviews">
          <h3 class="section-title">${txt.reviews_title}</h3>
            ${ratingSummaryHtml}
            ${reviewsHtml}
        </div>
        
        <!-- RELATED PRODUCTS -->
        <div class="related-section">
           <h3 class="section-title section-title--related">${txt.you_might_like}</h3>
           <div class="horizontal-scroll related-scroll" id="relatedList"></div>
        </div>

        <div id="imageViewer" class="image-viewer" aria-hidden="true" role="dialog" aria-label="Product image viewer">
          <div class="image-viewer__backdrop" onclick="closeImageViewer()"></div>
          <button type="button" class="image-viewer__close" onclick="closeImageViewer()" aria-label="Close image viewer">✕</button>
          <button type="button" class="image-viewer__nav image-viewer__nav--prev" onclick="scrollImageViewer(-1)" aria-label="Previous image">❮</button>
          <img id="imageViewerImg" class="image-viewer__img" src="" alt="Product image preview">
          <button type="button" class="image-viewer__nav image-viewer__nav--next" onclick="scrollImageViewer(1)" aria-label="Next image">❯</button>
          <div id="imageViewerCounter" class="image-viewer__counter"></div>
        </div>
      </div>
     `;
     
     document.getElementById("product-content").innerHTML = html;
    applyDynamicProductStyles();
    setupProductImageState();

     // Auto-play video if present
     if (p.video) {
         setTimeout(() => {
             const vidBtn = document.querySelector('.thumb-btn[onclick*="setMainVideo"]');
             if(vidBtn && typeof setMainVideo === 'function') {
                 setMainVideo(vidBtn, p.video);
             }
         }, 50);
     }
     
     if (typeof getCardHTML === "function") {
         const related = PRODUCTS.filter(x => x.cat === p.cat && x.id !== p.id).slice(0, 4);
         const listEl = document.getElementById("relatedList");
         if(related.length && listEl) {
             listEl.innerHTML = related.map(getCardHTML).join("");
         } else if(listEl) {
            document.querySelector(".related-section").style.display = 'none';
         }
     }

     // Initial Size Render
     const defaultColor = (p.colors && p.colors.find(c => !c.soldOut)) || (p.colors && p.colors[0]);
     if(defaultColor) renderSizes(defaultColor.name);
     else renderSizes(null); // Fallback to global specs

      bindMainImageViewerTrigger();

      syncFavoriteButton(p.id);
      updateAddToCartState();
  }

  function applyDynamicProductStyles() {
    document.querySelectorAll('.color-swatch[data-swatch-color]').forEach((swatch) => {
      const color = swatch.dataset.swatchColor;
      if (color) swatch.style.setProperty('--swatch-color', color);
    });

    document.querySelectorAll('.r-fill[data-width]').forEach((bar) => {
      const value = Number(bar.dataset.width);
      const normalized = Number.isFinite(value) ? Math.max(0, Math.min(100, value)) : 0;
      bar.style.width = `${normalized}%`;
    });
  }

  function setupProductImageState() {
    const wrapper = document.querySelector('.main-image-wrapper');
    const img = document.getElementById('ppMainImg');
    const fallback = document.getElementById('ppImageFallback');

    if(!wrapper || !img) return;

    const setLoading = (isLoading) => {
      wrapper.classList.toggle('is-loading', !!isLoading);
    };

    const toggleFallback = (visible) => {
      if(fallback) fallback.classList.toggle('is-visible', !!visible);
    };

    img.onload = () => {
      setLoading(false);
      toggleFallback(false);
      img.classList.remove('is-hidden');
    };

    img.onerror = () => {
      setLoading(false);
      img.classList.add('is-hidden');
      toggleFallback(true);
    };

    if(!img.src) {
      setLoading(false);
      toggleFallback(true);
      img.classList.add('is-hidden');
      return;
    }

    if(img.complete && img.naturalWidth > 0) {
      setLoading(false);
      toggleFallback(false);
      img.classList.remove('is-hidden');
      return;
    }

    setLoading(true);
    toggleFallback(false);
  }

  function getGalleryIndexBySrc(src) {
    if(!src || !productGalleryItems.length) return 0;
    try {
      const target = new URL(src, window.location.href).href;
      const found = productGalleryItems.findIndex((item) => new URL(item, window.location.href).href === target);
      return found >= 0 ? found : 0;
    } catch (e) {
      return 0;
    }
  }

  function updateImageViewerFrame() {
    const viewer = document.getElementById('imageViewer');
    const img = document.getElementById('imageViewerImg');
    const counter = document.getElementById('imageViewerCounter');
    if(!viewer || !img || !productGalleryItems.length) return;

    const total = productGalleryItems.length;
    if(activeGalleryIndex < 0) activeGalleryIndex = 0;
    if(activeGalleryIndex > total - 1) activeGalleryIndex = total - 1;

    img.src = productGalleryItems[activeGalleryIndex];
    counter.textContent = `${activeGalleryIndex + 1} / ${total}`;

    const prev = viewer.querySelector('.image-viewer__nav--prev');
    const next = viewer.querySelector('.image-viewer__nav--next');
    const hideNav = total < 2;
    if(prev) prev.style.display = hideNav ? 'none' : 'inline-flex';
    if(next) next.style.display = hideNav ? 'none' : 'inline-flex';
  }

  function bindMainImageViewerTrigger() {
    const img = document.getElementById('ppMainImg');
    if(!img) return;
    img.onclick = () => {
      const src = img.getAttribute('src') || img.src;
      openImageViewer(getGalleryIndexBySrc(src));
    };
  }

  window.openImageViewer = function(index) {
    const viewer = document.getElementById('imageViewer');
    if(!viewer || !productGalleryItems.length) return;
    activeGalleryIndex = Number.isFinite(Number(index)) ? Number(index) : 0;
    updateImageViewerFrame();
    viewer.classList.add('is-open');
    viewer.setAttribute('aria-hidden', 'false');
    document.body.classList.add('image-viewer-open');
  };

  window.closeImageViewer = function() {
    const viewer = document.getElementById('imageViewer');
    if(!viewer) return;
    viewer.classList.remove('is-open');
    viewer.setAttribute('aria-hidden', 'true');
    document.body.classList.remove('image-viewer-open');
  };

  window.scrollImageViewer = function(step) {
    if(!productGalleryItems.length) return;
    const total = productGalleryItems.length;
    if(total < 2) return;
    activeGalleryIndex = (activeGalleryIndex + step + total) % total;
    updateImageViewerFrame();
  };

  function renderSizes(colorName) {
      const p = currentProduct;
      if(!p) return;

      const container = document.getElementById("sizesContainer");
      if(!container) return;

      let sizes = [];
      let disabledSizes = [];

      // 1. Try to get sizes from specific color
      if(colorName && p.colors) {
          const colorObj = p.colors.find(c => c.name === colorName);
          if(colorObj) {
              if (colorObj.sizes && colorObj.sizes.length > 0) {
                  sizes = colorObj.sizes;
              }
              if (colorObj.disabledSizes) {
                  disabledSizes = colorObj.disabledSizes;
              }
          }
      }

      // 2. Fallback to global specs if no color-specific sizes found
      if(sizes.length === 0) {
        const sizeStr = p.specs && p.specs["Sizes"] && p.specs["Sizes"]["Available Sizes"] ? p.specs["Sizes"]["Available Sizes"] : "";
        sizes = sizeStr ? sizeStr.split(",").map(s => s.trim()).filter(Boolean) : [];
      }

      if(sizes.length === 0) {
          container.innerHTML = "";
          return;
      }

      const txt = currentUIText || { size: "Size", select: "Select" };
      const html = `<div class="options-wrap options-wrap--sizes">
        <div class="option-label">${txt.size}: <span id="sizeValue" data-placeholder="${txt.select}" class="muted size-value">${txt.select}</span></div>
         <div class="sizes-list">
             ${sizes.map((s) => {
               // Global availability check (optional override)
               const globalAvailable = (p.sizesAvailability || {})[s] !== false;
               const localAvailable = !disabledSizes.includes(s);
               const available = globalAvailable && localAvailable;
               
               return `
               <button class="size-pill ${available ? '' : 'is-soldout'}" ${available ? '' : 'disabled'} onclick="return selectSize(this, '${s}')" title="${available ? s : s + ' (Sold out)'}">${s}</button>
               `;
             }).join("")}
         </div>
       </div>`;
       
       container.innerHTML = html;
        updateAddToCartState();
  }

  window.updateQty = function(d) {
      const inp = document.getElementById("qtyInput");
      let v = parseInt(inp.value) + d;
      if(v < 1) v = 1;
      inp.value = v;
  };
  window.getQty = function() {
      return parseInt(document.getElementById("qtyInput").value) || 1;
  };

      window.selectSize = function(btn, size) {
        if(btn.classList.contains("is-soldout") || btn.disabled) return false;
        document.querySelectorAll(".size-pill").forEach(b => b.classList.remove("selected"));
        btn.classList.add("selected");
        const sv = document.getElementById("sizeValue");
        if(sv) sv.textContent = size;
        updateAddToCartState();
        return false;
      };

    function getSelectedSize(){
      const sv = document.getElementById("sizeValue");
      if(!sv) return "";
      const v = (sv.textContent || "").trim();
      const placeholder = (sv.dataset.placeholder || "Select").trim();
      return v === placeholder ? "" : v;
    }

    function productNeedsSizeSelection(){
      const selectable = document.querySelectorAll(".size-pill:not(.is-soldout):not([disabled])");
      return selectable.length > 0;
    }

    function updateAddToCartState(){
      const addBtn = document.getElementById("addToCartBtn");
      if(!addBtn) return;
      const needsSize = productNeedsSizeSelection();
      const hasSize = !!getSelectedSize();
      addBtn.disabled = needsSize && !hasSize;
    }

    function getProductSizes(id){
      const p = PRODUCTS.find(x => x.id === id);
      if(!p || !p.specs || !p.specs["Sizes"]) return [];
      const s = p.specs["Sizes"]["Available Sizes"] || "";
      return s ? s.split(",").map(x => x.trim()).filter(Boolean) : [];
    }

      window.handleAddToCart = function(id, silent){
      const sizes = getProductSizes(id);
      const size = getSelectedSize();
      if(sizes.length && !size){
        showToast((currentUIText && currentUIText.please_select_size) || "Please select a size");
        return;
      }
      addToCart(id, getQty(), size || null);
      showToast((currentUIText && currentUIText.added_to_cart) || "Added to Cart");
    };

  window.handleToggleFavorite = function(id) {
    let favs = [];
    try {
      favs = JSON.parse(localStorage.getItem("lc_favs_v2") || "[]");
      if(!Array.isArray(favs)) favs = [];
    } catch (e) {
      favs = [];
    }

    const idx = favs.indexOf(id);
    const adding = idx === -1;
    if(adding) favs.push(id);
    else favs.splice(idx, 1);

    localStorage.setItem("lc_favs_v2", JSON.stringify(favs));
    syncFavoriteButton(id);
    showToast(adding
      ? ((currentUIText && currentUIText.added_to_favorites) || "Added to Favorites")
      : ((currentUIText && currentUIText.removed_from_favorites) || "Removed from Favorites"));
  };

  function syncFavoriteButton(id){
    const btn = document.getElementById("favActionBtn");
    if(!btn) return;
    let favs = [];
    try {
      favs = JSON.parse(localStorage.getItem("lc_favs_v2") || "[]");
      if(!Array.isArray(favs)) favs = [];
    } catch (e) {
      favs = [];
    }
    const active = favs.includes(id);
    btn.classList.toggle("is-active", active);
    const svg = btn.querySelector("svg");
    if(svg) svg.setAttribute("fill", active ? "currentColor" : "none");
  }

  // Gallery Logic
  window.setMainImage = function(btn, src) {
      const img = document.getElementById("ppMainImg");
      const vid = document.getElementById("ppMainVideo");
      const wrapper = document.querySelector('.main-image-wrapper');
      const fallback = document.getElementById('ppImageFallback');
      
      if(vid) {
          vid.pause();
          vid.style.display = "none";
      }
      
      if(img) {
          img.style.display = "block";
        img.classList.remove('is-hidden');
          img.style.opacity = "0"; 
        if(wrapper) wrapper.classList.add('is-loading');
        if(fallback) fallback.classList.remove('is-visible');
          setTimeout(() => {
              img.src = src;
              img.style.opacity = "1";
          }, 200);
      }
      
      document.querySelectorAll(".thumb-btn").forEach(b => b.classList.remove("active"));
      if(btn) btn.classList.add("active");
  };

  window.setMainVideo = function(btn, src) {
      const img = document.getElementById("ppMainImg");
      const vid = document.getElementById("ppMainVideo");
      const wrapper = document.querySelector('.main-image-wrapper');
      const fallback = document.getElementById('ppImageFallback');
      
      if(img) img.style.display = "none";
      if(wrapper) wrapper.classList.remove('is-loading');
      if(fallback) fallback.classList.remove('is-visible');
      
      if(vid) {
          vid.src = src;
          vid.style.display = "block";
          vid.muted = true; // Ensure muted for autoplay
          vid.play().catch(e => console.log("Autoplay blocked", e));
      }
      
      document.querySelectorAll(".thumb-btn").forEach(b => b.classList.remove("active"));
      if(btn) btn.classList.add("active");
  };

  // Color Logic
    window.selectColor = function(btn, imgUrl, colorName) {
      if(colorName) {
        const cn = document.getElementById("colorName");
        if(cn) cn.textContent = colorName;
        
        // Update Sizes for this color
        renderSizes(colorName);
      }
      
      document.querySelectorAll(".color-swatch").forEach(b => b.classList.remove("selected"));
      btn.classList.add("selected");
      
      if(imgUrl && imgUrl !== 'undefined') {
        const img = document.getElementById("ppMainImg");
        const vid = document.getElementById("ppMainVideo");
        const wrapper = document.querySelector('.main-image-wrapper');
        const fallback = document.getElementById('ppImageFallback');
        
        // Switch to image mode
        if(vid) {
            vid.pause();
            vid.style.display = "none";
        }
        if(img) {
          img.style.display = "block";
          img.classList.remove('is-hidden');
          img.style.opacity = "0";
          if(wrapper) wrapper.classList.add('is-loading');
          if(fallback) fallback.classList.remove('is-visible');
          setTimeout(() => {
            img.src = imgUrl;
            img.style.opacity = "1";
          }, 200);
        }

        // Sync active thumbnail if it exists
        let foundThumb = null;
        document.querySelectorAll(".thumb-btn img").forEach(t => {
          if(t.src === imgUrl || t.src.endsWith(imgUrl)) foundThumb = t.parentElement;
        });
        if(foundThumb) {
          document.querySelectorAll(".thumb-btn").forEach(b => b.classList.remove("active"));
          foundThumb.classList.add("active");
        }
      }
  };
  
  function label(cat){
      return cat.charAt(0).toUpperCase() + cat.slice(1);
  }
</script>
<button id="backToTop" aria-label="Back to top">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19V5"></path><path d="M5 12l7-7 7 7"></path></svg>
</button>
<!--Start of Tawk.to Script-->
<script type="text/javascript">
var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='https://embed.tawk.to/6989024f1377141c38bccfd9/default';
s1.charset='UTF-8';
s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();
</script>
<!--End of Tawk.to Script-->
</body>
</html>

