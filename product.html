<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9N1CPZQ1HG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9N1CPZQ1HG');
</script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Product Details - Lecomax</title>

  <!-- Open Graph / Link Preview Tags -->
  <meta property="og:title" content="Premium Product - Lecomax" />
  <meta property="og:description" content="Check out our latest premium electronics, fashion, and accessories. Fast delivery and quality guaranteed." />
  <meta property="og:type" content="product" />
  <meta property="og:image" content="https://raw.githubusercontent.com/lecomaxstore-prog/lecomax/refs/heads/main/images/WirelessGamingController/1.avif" />
  
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Premium Product - Lecomax" />
  <meta name="twitter:description" content="Check out our latest premium electronics, fashion, and accessories." />
  <meta name="twitter:image" content="https://raw.githubusercontent.com/lecomaxstore-prog/lecomax/refs/heads/main/images/WirelessGamingController/1.avif" />

  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>

  <!-- Announcement Bar -->
  <div class="announcement">
    <div class="container announcement__inner">
      <span style="display:flex; align-items:center; gap:8px">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="opacity:0.8"><rect x="1" y="3" width="15" height="13"></rect><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon><circle cx="5.5" cy="18.5" r="2.5"></circle><circle cx="18.5" cy="18.5" r="2.5"></circle></svg>
        Free shipping on all products
      </span>
      <div class="toplinks">
        <a class="toplink" href="help-center.html">
           <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg> 
           Support
        </a>
        <a class="toplink" href="warranty.html">
           <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
           Warranty
        </a>
      </div>
    </div>
  </div>

  <header class="header" id="header">
    <div class="container header__inner">
      <a class="brand" href="index.html" aria-label="Lecomax Home">
        <!-- New Logo Icon -->
        <svg class="brand__logo" width="34" height="34" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M8 8C8 5.79086 9.79086 4 12 4H16C18.2091 4 20 5.79086 20 8V32C20 34.2091 18.2091 36 16 36H12C9.79086 36 8 34.2091 8 32V8Z" fill="#3b82f6"/>
          <path d="M22 24C22 21.7909 23.7909 20 26 20H32C34.2091 20 36 21.7909 36 24V32C36 34.2091 34.2091 36 32 36H26C23.7909 36 22 34.2091 22 32V24Z" fill="#0f172a"/>
        </svg>
        <span class="brand__name">LECOMAX</span>
      </a>

      <div class="search-container">
        <div class="searchbox">
          <input type="search" placeholder="Search..." disabled style="opacity:0.7">
          <button class="searchbox__submit" type="button"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg></button>
        </div>
      </div>

      <div class="actions">
        <a href="index.html" class="iconbtn" aria-label="Home">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
        </a>
        <button class="iconbtn" id="openCart" type="button" aria-label="Cart">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
          <span class="badge" id="cartCount">0</span>
        </button>
      </div>
    </div>
  </header>

  <main class="section">
    <div class="container" id="product-content">
      <!-- Content injected by JS -->
      <div style="padding:100px; text-align:center; color:var(--muted)">Loading product...</div>
    </div>
  </main>

  <footer class="footer">
    <div class="container footer__inner">
      <p class="muted">© <span id="year"></span> Lecomax. All rights reserved.</p>
    </div>
  </footer>

  <!-- Cart Drawer -->
  <aside class="drawer" id="drawer" aria-hidden="true">
    <div class="drawer__bg" data-close="1"></div>
    <div class="drawer__panel">
      <div class="drawer__head">
         <div class="drawer__title">Cart</div>
         <button class="iconbtn" data-close="1" onclick="closeAll()">✕</button>
      </div>
      <div class="drawer__body" id="cartItems"></div>
      <div class="drawer__foot">
         <div class="totals"><span class="muted">Total</span><strong id="total">0 MAD</strong></div>
         <button class="btn btn--primary w100" id="checkout">Checkout</button>
      </div>
    </div>
  </aside>

<script src="app.js"></script>
<script>
  // Current product global
  let currentProduct = null;

  // Listen for language changes to re-render product details
  window.addEventListener('languageChanged', (e) => {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");
      if(id && typeof renderProductDetail === 'function') {
          renderProductDetail(id);
          // Re-init zoom
          if(typeof enableProductImageZoom === 'function') {
             setTimeout(enableProductImageZoom, 100); 
          }
      }
  });

  document.addEventListener("DOMContentLoaded", () => {
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");
    if(id) renderProductDetail(id);
    else showNotFound();
    
    // Wire up year
    const yearEl = document.getElementById("year");
    if(yearEl) yearEl.textContent = new Date().getFullYear();
  });

  function showNotFound() {
      document.getElementById("product-content").innerHTML = "<div style='text-align:center; padding: 60px;'><h2>Product Not Found</h2><br><a href='index.html' class='btn btn--primary'>Continue Shopping</a></div>";
  }

  function renderProductDetail(id) {
     const rawP = PRODUCTS.find(x => x.id === id);
     if(!rawP) { showNotFound(); return; }
     
     // Localize based on current settings
     const lang = localStorage.getItem('lecomax_lang') || 'en';
     const p = { ...rawP }; // clone to avoid mutating original shared object permanently if we switched back and forth
     
     if(lang === 'fr') {
         if(p.name_fr) p.name = p.name_fr;
         if(p.desc_fr) p.desc = p.desc_fr;
     } else if (lang === 'ar') {
         if(p.name_ar) p.name = p.name_ar;
         if(p.desc_ar) p.desc = p.desc_ar;
     }
     
     // Translation Dictionary for UI Elements
     const UI_TEXT = {
         en: {
             specs_title: "Product Specifications",
             reviews_title: "Customer Reviews",
             based_on: "Based on",
             reviews: "reviews",
             you_might_like: "You might also like",
             verified_buyer: "Verified Buyer",
             add_to_cart: "Add to Cart",
             save: "Save",
             free_shipping_title: "Free Express",
             free_shipping_desc: "Delivery in 3 days",
             warranty_title: "12 Months",
             warranty_desc: "Official warranty",
             returns_title: "30-Day",
             returns_desc: "Easy returns",
             payment_title: "Secure",
             payment_desc: "Payment",
             color: "Color"
         },
         fr: {
             specs_title: "Spécifications du Produit",
             reviews_title: "Avis Clients",
             based_on: "Basé sur",
             reviews: "avis",
             you_might_like: "Vous aimerez peut-être aussi",
             verified_buyer: "Acheteur Vérifié",
             add_to_cart: "Ajouter au Panier",
             save: "Économisez",
             free_shipping_title: "Livraison Express",
             free_shipping_desc: "Gratuite en 3 jours",
             warranty_title: "12 Mois",
             warranty_desc: "Garantie officielle",
             returns_title: "30 Jours",
             returns_desc: "Retours faciles",
             payment_title: "Paiement",
             payment_desc: "Sécurisé",
             color: "Couleur"
         },
         ar: {
             specs_title: "مواصفات المنتج",
             reviews_title: "آراء العملاء",
             based_on: "بناءً على",
             reviews: "مراجعة",
             you_might_like: "قد يعجبك أيضاً",
             verified_buyer: "مشتري موثق",
             add_to_cart: "أضف إلى السلة",
             save: "وفر",
             free_shipping_title: "شحن سريع",
             free_shipping_desc: "توصيل خلال 3 أيام",
             warranty_title: "12 شهراً",
             warranty_desc: "ضمان معتمد",
             returns_title: "30 يوماً",
             returns_desc: "استرجاع سهل",
             payment_title: "دفع",
             payment_desc: "آمن",
             color: "اللون"
         }
     };
     
     const txt = UI_TEXT[lang] || UI_TEXT.en;
     
     // Spec Key/Value Translations (Best Effort)
     const SPEC_TRANS = {
        fr: {
            "Brand": "Marque", "Model": "Modèle", "Material": "Matériau", "Color": "Couleur",
            "Style": "Style", "Gender": "Genre", "Season": "Saison", "Size": "Taille",
            "Weight": "Poids", "Dimensions": "Dimensions", "Features": "Caractéristiques",
            "General": "Général", "Design": "Design", "Black": "Noir", "White": "Blanc",
            "Men": "Hommes", "Women": "Femmes", "Casual": "Décontracté", "Sports": "Sport",
            "Polyester": "Polyester", "Cotton": "Coton", "Origin": "Origine", "China": "Chine",
            "Wireless": "Sans fil", "Battery": "Batterie", "Charging": "Recharge",
            "Product Type": "Type de Produit", "Closure Type": "Fermeture", "Sleeve Length": "Manches",
            "Available Sizes": "Tailles Disponibles", "Usage": "Usage", "Pattern": "Motif",
            "Solid": "Uni", "Hooded": "À capuche", "Pockets": "Poches", "Regular": "Régulier",
            "Loose": "Ample", "Fit Type": "Coupe", "Connectivity": "Connectivité", "None": "Aucun"
        },
        ar: {
            "Brand": "العلامة التجارية", "Model": "الموديل", "Material": "الخامة", "Color": "اللون",
            "Style": "النمط", "Gender": "الجنس", "Season": "الفصل", "Size": "المقاس",
            "Weight": "الوزن", "Dimensions": "الأبعاد", "Features": "الميزات",
            "General": "عام", "Design": "التصميم", "Black": "أسود", "White": "أبيض",
            "Men": "رجال", "Women": "نساء", "Casual": "كاجوال", "Sports": "رياضي",
            "Polyester": "بوليستر", "Cotton": "قطن", "Origin": "المنشأ", "China": "الصين",
            "Wireless": "لاسلكي", "Battery": "البطارية", "Charging": "الشحن",
            "Product Type": "نوع المنتج", "Closure Type": "نوع الإغلاق", "Sleeve Length": "طول الكم",
            "Available Sizes": "المقاسات المتوفرة", "Usage": "الاستخدام", "Pattern": "النقش",
            "Solid": "لون موحد", "Hooded": "بقلنسوة", "Pockets": "جيوب", "Regular": "عادي",
            "Loose": "واسع", "Fit Type": "نوع القصة", "Connectivity": "الاتصال", "None": "لا يوجد"
        }
     };
     
     const trSpec = (str) => {
         if(!str) return str;
         if(typeof str !== 'string') return str;
         const map = SPEC_TRANS[lang];
         if(!map) return str;
         // Try exact match first
         if(map[str]) return map[str];
         // Try replace common words if key is sentence-like? (Risky, skip for now to avoid broken sentences)
         return str;
     }


     currentProduct = p;

     // Determine colors
     let colorHtml = "";
     if(p.colors && p.colors.length > 0) {
         // Auto-select first non-soldout color
         const defaultColor = p.colors.find(c => !c.soldOut) || p.colors[0];

         colorHtml = `<div class="options-wrap">
             <div class="option-label">${txt.color}: <span id="colorName">${defaultColor.name}</span></div>
             <div class="colors-list">
                ${p.colors.map((c, i) => `
                   <button class="color-swatch ${c.soldOut ? 'sold-out' : ''} ${c.name === defaultColor.name ? 'selected' : ''}" 
                     onclick="if(!this.classList.contains('sold-out')) selectColor(this, '${c.img}', '${c.name.replace(/'/g, "\\'")}')" 
                     style="background:${c.hex}; ${c.soldOut ? 'opacity:0.4; cursor:not-allowed; position:relative;' : ''}" 
                     title="${c.name} ${c.soldOut ? '(Sold Out)' : ''}">
                     ${c.soldOut ? '<span style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center; color:#fff; font-size:20px; text-shadow:0 0 2px #000;">✕</span>' : ''}
                   </button>
                `).join("")}
             </div>
         </div>`;
     }
     
     // Determine sizes (Initial render based on default color)
     let sizeHtml = "";
     // We create a container for sizes that we can update later
     sizeHtml = `<div id="sizesContainer"></div>`;
     
     // ... rest of generation ...

     // Determine thumbs
     let thumbHtml = "";
     
     // Add Video Thumbnail if exists
     if(p.video) {
        thumbHtml += `
            <div class="thumb-btn video-thumb" onclick="setMainVideo(this, '${p.video}')" style="position:relative; display:flex; align-items:center; justify-content:center; background:#000;">
              <div style="position:absolute; width:24px; height:24px; background:rgba(0,0,0,0.6); border-radius:50%; display:flex; align-items:center; justify-content:center; color:#fff; font-size:12px;">▶</div>
              <video src="${p.video}" muted style="width:100%; height:100%; object-fit:cover; opacity:0.7;"></video>
            </div>
        `;
     }
     
     if(p.images && p.images.length > 0) {
         thumbHtml += p.images.map((src, i) => `
            <div class="thumb-btn ${i===0 && !p.video ?'active':''}" onclick="setMainImage(this, '${src.replace(/'/g, "\\'")}')">
              <img src="${src}" alt="">
            </div>
         `).join("");
     }

     // Generate specs block
     let specsHtml = "";
     if (p.specs) {
        specsHtml = `<div class="specs-block" id="specs">
            <h3 style="font-size: 1.6rem; font-weight: 800; margin-bottom: 30px;">${txt.specs_title}</h3>
            <div class="specs-grid-layout">
                ${Object.entries(p.specs).map(([category, items]) => `
                    <div class="spec-group">
                        <h4>${trSpec(category)}</h4>
                        <div class="spec-list">
                            ${Object.entries(items).map(([key, value]) => `
                                <div class="spec-row">
                                    <span class="spec-key">${trSpec(key)}</span>
                                    <span class="spec-val">${trSpec(value)}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>`;
     }

      // Generate realistic high ratings (mostly 5 and 4 stars)
      let reviewCount = Math.max(12, (hashStr(p.id) % 20) + 12); // 12..32 reviews
      let rTotal = reviewCount;
      
      // Dynamic distribution logic based on rating
      let d5=0, d4=0, d3=0, d2=0, d1=0;
      
      if (p.rating >= 4.7) {
        d5 = Math.ceil(rTotal * 0.85);
        if(d5 > rTotal) d5 = rTotal;
        d4 = rTotal - d5;
      } else if (p.rating >= 4.0) {
        d5 = Math.floor(rTotal * 0.60);
        d4 = Math.floor(rTotal * 0.30);
        d3 = rTotal - d5 - d4;
      } else {
        d5 = Math.floor(rTotal * 0.50);
        d4 = Math.floor(rTotal * 0.30);
        d3 = Math.floor(rTotal * 0.15);
        d2 = rTotal - d5 - d4 - d3;
      }
      
      let rDist = [d5, d4, d3, d2, d1];
     
     const ratingSummaryHtml = `
        <div class="rating-summary">
              <div class="rating-overall">
                 <div class="rating-score">${p.rating.toFixed(1)}</div>
                 <div class="rating-stars-lg" style="color: #f59e0b;">${typeof starIcons === 'function' ? starIcons(Math.round(p.rating)) : "★★★★★"}</div>
                 <div class="rating-count-lg">${txt.based_on} ${reviewCount} ${txt.reviews}</div>
              </div>
          <div class="rating-bars">
             <div class="rating-bar-row">
                 <span class="r-label">5 ★</span>
                 <div class="r-track"><div class="r-fill" style="width:${(rDist[0]/reviewCount*100).toFixed(0)}%"></div></div>
                 <span class="r-count">${rDist[0]}</span>
             </div>
             <div class="rating-bar-row">
                 <span class="r-label">4 ★</span>
                 <div class="r-track"><div class="r-fill" style="width:${(rDist[1]/reviewCount*100).toFixed(0)}%"></div></div>
                 <span class="r-count">${rDist[1]}</span>
             </div>
             <div class="rating-bar-row">
                 <span class="r-label">3 ★</span>
                 <div class="r-track"><div class="r-fill" style="width:${(rDist[2]/reviewCount*100).toFixed(0)}%"></div></div>
                 <span class="r-count">${rDist[2]}</span>
             </div>
             <div class="rating-bar-row">
                 <span class="r-label">2 ★</span>
                 <div class="r-track"><div class="r-fill" style="width:${(rDist[3]/reviewCount*100).toFixed(0)}%"></div></div>
                 <span class="r-count">${rDist[3]}</span>
             </div>
             <div class="rating-bar-row">
                 <span class="r-label">1 ★</span>
                 <div class="r-track"><div class="r-fill" style="width:${(rDist[4]/reviewCount*100).toFixed(0)}%"></div></div>
                 <span class="r-count">${rDist[4]}</span>
             </div>
          </div>
        </div>
     `;

    let reviewsHtml = `<div class="reviews-grid">` + getFakeReviews(p.id, p.cat, lang, p.rating).slice(0, 5).map(r => {
         const colors = ['review-bg-blue', 'review-bg-green', 'review-bg-purple', 'review-bg-orange'];
         const colorClass = colors[hashStr(r.name) % colors.length];
         
         return `
         <div class="review-card">
            <div class="review-header">
                <div class="review-avatar ${colorClass}">${r.name.charAt(0)}</div>
                <div class="review-meta">
                    <div class="review-author">
                        ${r.name}
                        <span class="verified-badge">
                           <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                           ${txt.verified_buyer}
                        </span>
                    </div>
                    <div class="review-stars" style="color: #f59e0b;">${typeof starIcons === 'function' ? starIcons(Math.round(r.rating)) : "★".repeat(Math.round(r.rating))}</div>
                </div>
                <div class="review-date">${r.date}</div>
            </div>
            <div class="review-body">
                “${r.text}”
            </div>
            <div class="review-tags">
                <span class="review-tag">${r.tag}</span>
            </div>
         </div>
     `}).join("") + `</div>`;

      const html = `
        <div class="product-page">
           <!-- Improved Breadcrumb -->
           <nav class="breadcrumb" style="margin: 8px 0 14px 0; font-size: 0.85rem; color: var(--muted); display:flex; align-items:center; gap:8px;">
              <button onclick="history.back()" style="border:none; background:none; padding:8px; margin-right:4px; margin-left:-8px; cursor:pointer; color:var(--text); display:flex; align-items:center; border-radius:50%; transition:background 0.2s" onmouseover="this.style.background='rgba(0,0,0,0.05)'" onmouseout="this.style.background='none'" title="Go Back">
                 <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
              </button>
              
              <a href="index.html" style="color:var(--muted); text-decoration:none; transition:color 0.2s; display:flex; align-items:center; gap:4px">
                 <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                 Home
              </a>
              <span style="opacity:0.3">/</span>
              <a href="index.html?cat=${p.cat}" style="color:var(--muted); text-decoration:none; transition:color 0.2s">${label(p.cat)}</a>
              <span style="opacity:0.3">/</span>
              <span style="color:var(--text); font-weight:500">${p.name}</span>
           </nav>
        
        <div class="product-layout">
            <!-- Gallery Column -->
            <div class="product-gallery">
                <div class="main-image-wrapper" style="position:relative;">
                    <div class="zoom-container" style="position:relative; overflow:hidden;">
                      <img id="ppMainImg" src="${p.images && p.images[0] ? p.images[0] : ''}" alt="${p.name}" style="${(p.images && p.images.length) ? '' : 'display:none'}; cursor: zoom-in; transition: opacity 0.4s ease, transform 0.2s;">
                      <div id="zoomLens" style="display:none; position:absolute; pointer-events:none; border:2px solid #3b82f6; border-radius:50%; width:120px; height:120px; background:rgba(59,130,246,0.08); z-index:10;"></div>
                    </div>
                    <video id="ppMainVideo" controls autoplay loop playsinline muted style="display:none; width:100%; height:100%; object-fit:contain; position:absolute; top:0; left:0; background:#fff;"></video>
                    ${!(p.images && p.images.length) ? `<div style="font-size:8rem">${p.emoji}</div>` : ''}
                </div>
                <div class="thumbnails">
                    ${thumbHtml}
                </div>
            </div>
            
            <!-- Info Column -->
            <div class="product-info-col">
                <div class="product-cat" style="display:inline-flex; align-items:center; gap:6px; padding:4px 12px; border-radius:100px; background:#f0f9ff; color:#0284c7; font-weight:700; font-size:0.8rem; text-transform:uppercase; letter-spacing:0.04em;">
                    ${label(p.cat)}
                </div>
                <h1 class="product-title" style="margin: 8px 0; font-size: clamp(2rem, 3vw, 2.8rem); line-height: 1.1; letter-spacing: -0.02em; font-weight: 800; color: var(--text);">${p.name}</h1>
                
                <div class="price-block" style="margin-bottom: 20px;">
                    <div class="current-price" style="font-size: 2.2rem; font-weight: 800; color: #1e293b;">${p.price} MAD</div>
                    ${p.old ? `<div class="old-price" style="font-size: 1.2rem; margin-left:8px; position:relative; top:2px;">${p.old} MAD</div>` : ''}
                    ${p.old ? `<div class="save-badge" style="background:#dc2626; margin-left:12px; padding:4px 10px; border-radius:6px; text-transform:uppercase;">Save ${Math.round(((p.old - p.price)/p.old)*100)}%</div>` : ''}
                </div>

                <div class="rating-block" style="color: #f59e0b;">
                    ${typeof starIcons === 'function' ? starIcons(Math.round(p.rating)) : '<span class="stars" style="letter-spacing:1px;">★★★★★</span>'} 
                    <span style="color:var(--text); font-weight:600; margin-left:4px;">${p.rating.toFixed(1)}</span>
                    <a href="#reviews" class="muted" style="text-decoration:underline; font-weight:400; margin-left:6px; color:var(--muted);">(${reviewCount} reviews)</a>
                </div>
                
                <p class="description">
                    ${p.desc || "Experience premium quality with our latest collection."}
                </p>

                <hr class="divider">

                ${colorHtml}
                ${sizeHtml}

                <div class="cart-actions" style="margin-top: 24px; display: grid; grid-template-columns: 140px 1fr auto; gap: 12px; align-items: stretch;">
                     <div class="qty-box" style="height: 54px; display: flex; align-items: center; border: 2px solid #e2e8f0; border-radius: 12px; overflow: hidden; background: #fff;">
                        <button class="qty-btn" onclick="updateQty(-1)" style="flex: 1; height: 100%; border: none; background: none; cursor: pointer; font-size: 1.2rem; color: var(--text); transition: background 0.2s;">−</button>
                        <input id="qtyInput" class="qty-val" value="1" readonly style="width: 40px; text-align: center; border: none; background: none; font-weight: 700; font-size: 1.1rem; color: var(--text);">
                        <button class="qty-btn" onclick="updateQty(1)" style="flex: 1; height: 100%; border: none; background: none; cursor: pointer; font-size: 1.2rem; color: var(--text); transition: background 0.2s;">+</button>
                     </div>
                     
                    <button class="btn btn--primary add-btn" onclick="handleAddToCart('${p.id}')" style="height: 54px; border-radius: 12px; font-size: 1.1rem; letter-spacing: 0.02em; box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);">
                        ${txt.add_to_cart}
                     </button>
                     
                     <button class="fav-action-btn" onclick="handleAddToCart('${p.id}', true)" title="Add to Wishlist" style="height: 54px; width: 54px; border-radius: 12px; border: 2px solid #e2e8f0; display: flex; align-items: center; justify-content: center; cursor: pointer; background: #fff; transition: all 0.2s;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                     </button>
                </div>
                
                <div class="trust-bar" style="margin-top: 32px; padding-top: 24px; border-top: 1px solid var(--line); display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                    <div class="trust-item" style="display: flex; align-items: center; gap: 14px; padding: 12px; background: #f8fafc; border-radius: 12px; border: 1px solid #f1f5f9;">
                        <div style="width: 44px; height: 44px; background: #fff; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #0284c7; box-shadow: 0 4px 10px rgba(0,0,0,0.03);">
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="3" width="15" height="13"></rect><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon><circle cx="5.5" cy="18.5" r="2.5"></circle><circle cx="18.5" cy="18.5" r="2.5"></circle></svg>
                        </div>
                        <div style="font-size: 0.9rem; font-weight: 700; color: #334155;">${txt.free_shipping_title}<br><span style="font-weight:400; font-size:0.8rem; color:#64748b;">${txt.free_shipping_desc}</span></div>
                    </div>
                    
                    <div class="trust-item" style="display: flex; align-items: center; gap: 14px; padding: 12px; background: #f8fafc; border-radius: 12px; border: 1px solid #f1f5f9;">
                        <div style="width: 44px; height: 44px; background: #fff; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #16a34a; box-shadow: 0 4px 10px rgba(0,0,0,0.03);">
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                        </div>
                        <div style="font-size: 0.9rem; font-weight: 700; color: #334155;">${txt.warranty_title}<br><span style="font-weight:400; font-size:0.8rem; color:#64748b;">${txt.warranty_desc}</span></div>
                    </div>

                    <div class="trust-item" style="display: flex; align-items: center; gap: 14px; padding: 12px; background: #f8fafc; border-radius: 12px; border: 1px solid #f1f5f9;">
                        <div style="width: 44px; height: 44px; background: #fff; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #ca8a04; box-shadow: 0 4px 10px rgba(0,0,0,0.03);">
                             <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>
                        </div>
                        <div style="font-size: 0.9rem; font-weight: 700; color: #334155;">${txt.returns_title}<br><span style="font-weight:400; font-size:0.8rem; color:#64748b;">${txt.returns_desc}</span></div>
                    </div>
                    
                     <div class="trust-item" style="display: flex; align-items: center; gap: 14px; padding: 12px; background: #f8fafc; border-radius: 12px; border: 1px solid #f1f5f9;">
                        <div style="width: 44px; height: 44px; background: #fff; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #7c3aed; box-shadow: 0 4px 10px rgba(0,0,0,0.03);">
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>
                        </div>
                        <div style="font-size: 0.9rem; font-weight: 700; color: #334155;">${txt.payment_title}<br><span style="font-weight:400; font-size:0.8rem; color:#64748b;">${txt.payment_desc}</span></div>
                    </div>
                </div>
            </div>
        </div>

        ${specsHtml}

        <!-- REVIEWS SECTION -->
        <div class="reviews-section" id="reviews" style="margin-top: 80px;">
            <h3 style="font-size:1.6rem; margin-bottom:30px; font-weight:800;">${txt.reviews_title}</h3>
            ${ratingSummaryHtml}
            ${reviewsHtml}
        </div>
        
        <!-- RELATED PRODUCTS -->
        <div class="related-section" style="margin-top:80px; padding-top:40px; border-top:1px solid var(--line)">
             <h3 style="font-size:1.6rem; margin-bottom:24px; font-weight:800;">${txt.you_might_like}</h3>
             <div class="horizontal-scroll" id="relatedList" style="display:flex; gap:16px; overflow-x:auto; padding-bottom:20px;"></div>
        </div>
      </div>
     `;
     
     document.getElementById("product-content").innerHTML = html;

     // Auto-play video if present
     if (p.video) {
         setTimeout(() => {
             const vidBtn = document.querySelector('.thumb-btn[onclick*="setMainVideo"]');
             if(vidBtn && typeof setMainVideo === 'function') {
                 setMainVideo(vidBtn, p.video);
             }
         }, 50);
     }
     
     if (typeof getCardHTML === "function") {
         const related = PRODUCTS.filter(x => x.cat === p.cat && x.id !== p.id).slice(0, 4);
         const listEl = document.getElementById("relatedList");
         if(related.length && listEl) {
             listEl.innerHTML = related.map(getCardHTML).join("");
         } else if(listEl) {
            document.querySelector(".related-section").style.display = 'none';
         }
     }

     // Initial Size Render
     const defaultColor = (p.colors && p.colors.find(c => !c.soldOut)) || (p.colors && p.colors[0]);
     if(defaultColor) renderSizes(defaultColor.name);
     else renderSizes(null); // Fallback to global specs
  }

  function renderSizes(colorName) {
      const p = currentProduct;
      if(!p) return;

      const container = document.getElementById("sizesContainer");
      if(!container) return;

      let sizes = [];
      let disabledSizes = [];

      // 1. Try to get sizes from specific color
      if(colorName && p.colors) {
          const colorObj = p.colors.find(c => c.name === colorName);
          if(colorObj) {
              if (colorObj.sizes && colorObj.sizes.length > 0) {
                  sizes = colorObj.sizes;
              }
              if (colorObj.disabledSizes) {
                  disabledSizes = colorObj.disabledSizes;
              }
          }
      }

      // 2. Fallback to global specs if no color-specific sizes found
      if(sizes.length === 0) {
        const sizeStr = p.specs && p.specs["Sizes"] && p.specs["Sizes"]["Available Sizes"] ? p.specs["Sizes"]["Available Sizes"] : "";
        sizes = sizeStr ? sizeStr.split(",").map(s => s.trim()).filter(Boolean) : [];
      }

      if(sizes.length === 0) {
          container.innerHTML = "";
          return;
      }

      const html = `<div class="options-wrap" style="margin-top:16px;">
         <div class="option-label">Size: <span id="sizeValue" class="muted" style="font-weight:700; margin-left:6px;">Select</span></div>
         <div class="sizes-list" style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
             ${sizes.map((s) => {
               // Global availability check (optional override)
               const globalAvailable = (p.sizesAvailability || {})[s] !== false;
               const localAvailable = !disabledSizes.includes(s);
               const available = globalAvailable && localAvailable;
               
               return `
               <button class="size-pill ${available ? '' : 'is-soldout'}" ${available ? '' : 'disabled'} onclick="return selectSize(this, '${s}')" title="${available ? s : s + ' (Sold out)'}">${s}</button>
               `;
             }).join("")}
         </div>
       </div>`;
       
       container.innerHTML = html;
  }

  window.updateQty = function(d) {
      const inp = document.getElementById("qtyInput");
      let v = parseInt(inp.value) + d;
      if(v < 1) v = 1;
      inp.value = v;
  };
  window.getQty = function() {
      return parseInt(document.getElementById("qtyInput").value) || 1;
  };

      window.selectSize = function(btn, size) {
        if(btn.classList.contains("is-soldout") || btn.disabled) return false;
        document.querySelectorAll(".size-pill").forEach(b => b.classList.remove("selected"));
        btn.classList.add("selected");
        const sv = document.getElementById("sizeValue");
        if(sv) sv.textContent = size;
        return false;
      };

    function getSelectedSize(){
      const sv = document.getElementById("sizeValue");
      if(!sv) return "";
      const v = (sv.textContent || "").trim();
      return v === "Select" ? "" : v;
    }

    function getProductSizes(id){
      const p = PRODUCTS.find(x => x.id === id);
      if(!p || !p.specs || !p.specs["Sizes"]) return [];
      const s = p.specs["Sizes"]["Available Sizes"] || "";
      return s ? s.split(",").map(x => x.trim()).filter(Boolean) : [];
    }

      window.handleAddToCart = function(id, silent){
      const sizes = getProductSizes(id);
      const size = getSelectedSize();
      if(sizes.length && !size){
        showToast("Please select a size");
        return;
      }
      addToCart(id, getQty(), size || null);
        showToast("Added to Cart");
    };

  // Gallery Logic
  window.setMainImage = function(btn, src) {
      const img = document.getElementById("ppMainImg");
      const vid = document.getElementById("ppMainVideo");
      
      if(vid) {
          vid.pause();
          vid.style.display = "none";
      }
      
      if(img) {
          img.style.display = "block";
          img.style.opacity = "0"; 
          setTimeout(() => {
              img.src = src;
              img.style.opacity = "1";
          }, 200);
      }
      
      document.querySelectorAll(".thumb-btn").forEach(b => b.classList.remove("active"));
      if(btn) btn.classList.add("active");
  };

  window.setMainVideo = function(btn, src) {
      const img = document.getElementById("ppMainImg");
      const vid = document.getElementById("ppMainVideo");
      
      if(img) img.style.display = "none";
      
      if(vid) {
          vid.src = src;
          vid.style.display = "block";
          vid.muted = true; // Ensure muted for autoplay
          vid.play().catch(e => console.log("Autoplay blocked", e));
      }
      
      document.querySelectorAll(".thumb-btn").forEach(b => b.classList.remove("active"));
      if(btn) btn.classList.add("active");
  };

  // Color Logic
    window.selectColor = function(btn, imgUrl, colorName) {
      if(colorName) {
        const cn = document.getElementById("colorName");
        if(cn) cn.textContent = colorName;
        
        // Update Sizes for this color
        renderSizes(colorName);
      }
      
      document.querySelectorAll(".color-swatch").forEach(b => b.classList.remove("selected"));
      btn.classList.add("selected");
      
      if(imgUrl && imgUrl !== 'undefined') {
        const img = document.getElementById("ppMainImg");
        const vid = document.getElementById("ppMainVideo");
        
        // Switch to image mode
        if(vid) {
            vid.pause();
            vid.style.display = "none";
        }
        if(img) {
          img.style.display = "block";
          img.style.opacity = "0";
          setTimeout(() => {
            img.src = imgUrl;
            img.style.opacity = "1";
          }, 200);
        }

        // Sync active thumbnail if it exists
        let foundThumb = null;
        document.querySelectorAll(".thumb-btn img").forEach(t => {
          if(t.src === imgUrl || t.src.endsWith(imgUrl)) foundThumb = t.parentElement;
        });
        if(foundThumb) {
          document.querySelectorAll(".thumb-btn").forEach(b => b.classList.remove("active"));
          foundThumb.classList.add("active");
        }
      }
  };
  
  function label(cat){
      return cat.charAt(0).toUpperCase() + cat.slice(1);
  }
</script>
<button id="backToTop" aria-label="Back to top">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19V5"></path><path d="M5 12l7-7 7 7"></path></svg>
</button>
<!--Start of Tawk.to Script-->
<script type="text/javascript">
var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='https://embed.tawk.to/6989024f1377141c38bccfd9/default';
s1.charset='UTF-8';
s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();
</script>
<!--End of Tawk.to Script-->
</body>
</html>
